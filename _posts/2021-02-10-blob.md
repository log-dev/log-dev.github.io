---
layout: post
title: "Understanding Blob"
author: "Logger"
thumbnail: "https://heropy.blog/css/images/vendor_icons/javascript.png"
tags: 
---


![image](https://heropy.blog/css/images/vendor_icons/javascript.png)

# Blob?

In JavaScript, a Binary Large Object (Blob) can be used to handle multimedia data such as images, sounds, and videos.
It is usually used to determine the size (Byte) and MIME type of data, or to divide the data into small Blob objects for transmission and receipt.
In this article, we will learn how to create, read, and write Blob.

> The File object is also a Blob object with properties 'name' and 'lastModifiedDate'.

![image](https://heropy.blog/images/screenshot/blob/blob-file-object.jpg)

# Create Blob

The Blob constructor returns a new Blob object.
When created, it receives `array` and `options` as arguments.

```js
const newBlob = new Blob(array, options);

```

## array

You can use ArrayBuffer, ArrayBufferView, Blob(File), DOMString objects, or a mix of these objects as the first argument in the Blob constructor.

```js
new Blob([new ArrayBuffer(data)], { type: 'video/mp4' });
new Blob(new Uint8Array(data), { type: 'image/png' });
new Blob(['<div>Hello Blob!</div>'], {
type: 'text/html',
endings: 'native'
});

```

## options

Optionally, you can set `type` and `endings`.
`type` sets the MIME type of the data, and the default value is `"".
`endings` can specify string processing containing `\n` as `transparent` and `native`; default is `transparent`.

# Blob object

## Properties

The following is a Blob object created with a PNG image of approximately 43KB:

![image](https://heropy.blog/images/screenshot/blob/blob-object.jpg)

The Blob object created by the constructor has properties of `size` and `type`.
`size` refers to the byte unit size of the Blob object, and `type` refers to the MIME type of the object.
If the MIME type is unknown, an empty string (`"`) is assigned.

## Methods

The `slice` method available on a Blob object is used to create a new Blob object that contains data from a specified byte range.
Useful when using small pieces of Blob objects larger than 10MB in size.

```js
const blob = new Blob(); // New blob object
blob.slice(start, end, type);

```

`start` specifies the start range (Byte, Number), `end` specifies the end range (Byte, Number), and `type` specifies the MIME type (String) of the new Blob object.

```js
// Create the first 1KB JPG Blob object (chunk) in a blob object (blob)
const chunk = blob.slice(0, 1024, 'image/jpeg');

```

The following example fragments the Blob object (generated by a PNG image of approximately 43 KB) as seen above into 10 chunks.
Store each chunk in order in the `chunks` array.

```js
const chunks = [];
const numberOfSlices = 10;
const chunkSize = Math.ceil(blob.size / numberOfSlices);
for (let i = 0; i < numberOfSlices; i += 1) {
const startByte = chunkSize * i;
chunks.push(
blob.slice(
startByte,
startByte + chunkSize,
blob.type
)
);
}
console.log(chunks); // This is as follows..

```

![image](https://heropy.blog/images/screenshot/blob/blob-object-slice.jpg)

These fragmented Blob objects (Chunks) can be simply re-united as needed.

```js
const mergedBlob = new Blob(
chunks,
{ type: blob.type }
);
document.getElementById('merged-image').src = window.URL.createObjectURL(mergedBlob);
document.getElementById('chunk-image').src = window.URL.createObjectURL(chunk[0]);

// Revoke Blob URL..

```

The image below is the result of the code above, and the image on the left is the `#merged-image` element and the image on the right is the `#chunk-image` element.
You can see that the image on the right is cut to about 1/10.

> It is not intended to visually separate (sculpt) images, but it is attached for better understanding.

![image](https://heropy.blog/images/screenshot/blob/blob-origin-vs-sliced.jpg)

At the end of the code above, `URL.createObjectURL()` was used, which generates a URL pointing to the Blob object for reference in the DOM.
Let`s get a quick look at the Blob URL.

# Blob URL

You can use createObjectURL and revokeObjectURL as static methods for URL objects to generate URLs that point to Blob objects.

## createObjectURL

`URL.createObjectURL()` generates the following DOMString, including the URL representing the Blob object.(`blob:URL`)
This Blob URL is valid only in the document in the window that was created (browser).
It cannot be recycled from other windows, and because the URL has a limited lifetime, it can be out of security issues unlike `file:URL`.

```undefined
blob:http://localhost:1234/28ff8746-94eb-4dbe-9d6c-2443b581dd30

```

You can:

```xml
<img src="blob:http://localhost:1234/28ff8746-94eb-4dbe-9d6c-2443b581dd30" alt="Blob URL Image" />

```

## revokeObjectURL

`URL.revokeObjectURL()` releases (retires) an existing URL generated by `URL.createObjectURL()`.
If you do not disable it through `revokeObjectURL`, the existing URL will be considered valid and will not be GCed by the JavaScript engine.
To avoid memory leaks, it is recommended that you release the generated URL after binding it with the DOM.

```js
// Create Blob URL
const blobUrl = window.URL.createObjectURL(blob);

// Revoke Blob URL after DOM updates..
window.URL.revokeObjectURL(blobUrl);

```

# Browser Support Verification

To verify that the Blob object is supported in your browser, you can write:

```js
const blobSupported = new Blob(['aÌˆ']).size === 2; // Boolean

```

# Example of receiving a blob with AJAX

Add a `loadXHR` function to return Promise.
Receive the requested Blob object.
Example of inserting as URL into image tag `src`.

```js
function loadXHR(url) {
return new Promise((resolve, reject) => {
try {
const xhr = new XMLHttpRequest();
xhr.open("GET", url);
xhr.responseType = "blob";
xhr.onerror = event => {
reject(`Network error: ${event}`);
};
xhr.onload = () => {
if (xhr.status === 200) {
resolve(xhr.response);
} else {
reject(`XHR load error: ${xhr.statusText}`);
}
};
xhr.send();
} catch (err) {
reject(err.message);
}
});
}

```

```js
loadXHR('https://avatars3.githubusercontent.com/u/16679082?s=460
```

# References

https://developer.mozilla.org/ko/docs/Web/API/Blob#%EC%86%8D%EC%84%B1
https://github.com/eligrey/Blob.js/blob/master/Blob.js
https://firejune.com/1788/%EC%9E%90%EB%B0%94%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8%EC%97%90%EC%84%9C%EC%9D%98+BLOB+%EA%B0%9D%EC%B2%B4
https://taegon.kim/archives/5078
http://blog.naver.com/PostView.nhn?blogId=horajjan